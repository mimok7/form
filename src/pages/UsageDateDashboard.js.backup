import React, { useState, useMemo, useEffect } from 'react';
import './AdminDashboard.css';
import { useSheetData } from '../utils/adminAPI';

function UsageDateDashboard({ onBack }) {
  const [selectedDate, setSelectedDate] = useState(new Date());
  const [typeFilter, setTypeFilter] = useState('all');

  // ëª¨ë“  ì‹œíŠ¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
  const { data: SH_M_data = [], headers: SH_M_headers = [], loading: SH_M_loading } = useSheetData('SH_M') || {};
  const { data: SH_R_data = [], headers: SH_R_headers = [], loading: SH_R_loading } = useSheetData('SH_R') || {};
  const { data: SH_C_data = [], headers: SH_C_headers = [], loading: SH_C_loading } = useSheetData('SH_C') || {};
  const { data: SH_CC_data = [], headers: SH_CC_headers = [], loading: SH_CC_loading } = useSheetData('SH_CC') || {};
  const { data: SH_P_data = [], headers: SH_P_headers = [], loading: SH_P_loading } = useSheetData('SH_P') || {};
  const { data: SH_H_data = [], headers: SH_H_headers = [], loading: SH_H_loading } = useSheetData('SH_H') || {};
  const { data: SH_T_data = [], headers: SH_T_headers = [], loading: SH_T_loading } = useSheetData('SH_T') || {};
  const { data: SH_RC_data = [], headers: SH_RC_headers = [], loading: SH_RC_loading } = useSheetData('SH_RC') || {};

  const loading = SH_M_loading || SH_R_loading || SH_C_loading || SH_CC_loading || SH_P_loading || SH_H_loading || SH_T_loading || SH_RC_loading;

  // SH_M ë°ì´í„° ë””ë²„ê·¸
  React.useEffect(() => {
    if (!SH_M_loading && SH_M_data.length > 0) {
      console.log('SH_M loaded:', {
        headers: SH_M_headers,
        orderIdIndex: SH_M_headers.indexOf('ì£¼ë¬¸ID'),
        koreanNameIndex: SH_M_headers.indexOf('í•œê¸€ì´ë¦„'),
        dataLength: SH_M_data.length,
        firstRow: SH_M_data[0],
        sampleOrderIds: SH_M_data.slice(0, 5).map(r => r[SH_M_headers.indexOf('ì£¼ë¬¸ID')])
      });
    }
  }, [SH_M_data, SH_M_headers, SH_M_loading]);

  // í—¤ë”ì—ì„œ ì—´ ì¸ë±ìŠ¤ ì°¾ê¸° (ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ìŒ)
  const findColumnIndex = (headers, names) => {
    if (!Array.isArray(headers)) return -1;
    const searchNames = Array.isArray(names) ? names : [names];
    for (const name of searchNames) {
      const idx = headers.findIndex(h => 
        h && h.toString().toLowerCase().includes(name.toLowerCase())
      );
      if (idx !== -1) return idx;
    }
    return -1;
  };

  // í–‰ ë°ì´í„° ì¶”ì¶œ
  const getRowValue = (row, headers, fieldNames) => {
    const idx = findColumnIndex(headers, fieldNames);
    return idx !== -1 && row && row[idx] ? row[idx] : '';
  };

  // ì£¼ë¬¸IDë¡œ SH_M ì‹œíŠ¸ì—ì„œ ê³ ê°ëª… ì¡°íšŒ (ServiceDashboardBase ë°©ì‹ ì‚¬ìš©)
  const getCustomerNameByOrderId = useMemo(() => {
    return (orderId) => {
      if (!orderId) return '';
      if (!Array.isArray(SH_M_data) || SH_M_data.length === 0) return '';
      if (!Array.isArray(SH_M_headers) || SH_M_headers.length === 0) return '';
      
      // ì •í™•í•œ ì¼ì¹˜ë¡œ ì£¼ë¬¸ID ì»¬ëŸ¼ ì°¾ê¸° (ëŒ€ì†Œë¬¸ì êµ¬ë¶„)
      const orderIdIndex = SH_M_headers.indexOf('ì£¼ë¬¸ID');
      if (orderIdIndex === -1) {
        console.log('SH_M headers:', SH_M_headers);
        return '';
      }
      
      const koreanNameIndex = SH_M_headers.indexOf('í•œê¸€ì´ë¦„');
      if (koreanNameIndex === -1) return '';
      
      // ì£¼ë¬¸IDë¡œ íšŒì› ë°ì´í„° ì°¾ê¸° (í…ìŠ¤íŠ¸ ì •ê·œí™”)
      const orderIdStr = String(orderId).trim();
      const memberRow = SH_M_data.find(row => {
        const rowOrderId = row && row[orderIdIndex] ? String(row[orderIdIndex]).trim() : '';
        return rowOrderId === orderIdStr;
      });
      
      if (!memberRow) return '';
      
      const koreanName = memberRow[koreanNameIndex];
      return koreanName ? String(koreanName).trim() : '';
    };
  }, [SH_M_data, SH_M_headers]);

  // ë‚ ì§œ íŒŒì‹±
  const parseDate = (dateStr) => {
    if (!dateStr) return null;
    
    const str = String(dateStr).trim();
    
    try {
      // ISO í˜•ì‹ (YYYY-MM-DD)
      if (str.includes('-')) {
        const parts = str.split('-');
        if (parts.length >= 3) {
          const year = parseInt(parts[0]);
          const month = parseInt(parts[1]) - 1;
          const day = parseInt(parts[2]);
          return new Date(year, month, day);
        }
      }
      
      // ì  í˜•ì‹ (YYYY. MM. DD)
      if (str.includes('. ') || str.includes('.')) {
        const cleaned = str.replace(/\./g, ' ').trim();
        const parts = cleaned.split(/\s+/);
        if (parts.length >= 3) {
          const year = parseInt(parts[0]);
          const month = parseInt(parts[1]) - 1;
          const day = parseInt(parts[2]);
          const d = new Date(year, month, day);
          if (!isNaN(d.getTime())) return d;
        }
      }
      
      // ìŠ¬ë˜ì‹œ í˜•ì‹ (YYYY/MM/DD)
      if (str.includes('/')) {
        const parts = str.split('/');
        if (parts.length >= 3) {
          const year = parseInt(parts[0]);
          const month = parseInt(parts[1]) - 1;
          const day = parseInt(parts[2]);
          return new Date(year, month, day);
        }
      }
      
      // Date ê°ì²´ ì§ì ‘ íŒŒì‹±
      const d = new Date(str);
      if (!isNaN(d.getTime())) return d;
    } catch (e) {
      console.error('Date parse error:', e);
    }
    
    return null;
  };

  // ê°™ì€ ë‚ ì§œ ë¹„êµ
  const isSameDate = (d1, d2) => {
    if (!d1 || !d2) return false;
    return d1.getFullYear() === d2.getFullYear() &&
           d1.getMonth() === d2.getMonth() &&
           d1.getDate() === d2.getDate();
  };

  // ëª¨ë“  ì˜ˆì•½ ë°ì´í„° ë³€í™˜
  const allReservations = useMemo(() => {
    const results = [];

    // í¬ë£¨ì¦ˆ (SH_R)
    if (Array.isArray(SH_R_data)) {
      SH_R_data.forEach((row, idx) => {
        const orderId = getRowValue(row, SH_R_headers, ['ì˜ˆì•½ë²ˆí˜¸', 'ì£¼ë¬¸ë²ˆí˜¸', 'ID']);
        if (orderId && idx < 3) {
          console.log(`SH_R Row ${idx}:`, {
            orderId,
            sheetHeaders: SH_R_headers,
            sheetOrderIdIndex: SH_R_headers.indexOf('ì£¼ë¬¸ID'),
            rowData: row
          });
        }
        if (orderId) {
          const date = getRowValue(row, SH_R_headers, ['ì²´í¬ì¸', 'íƒ‘ìŠ¹ì¼', 'ë‚ ì§œ']);
          // SH_Mì—ì„œ ì¡°íšŒí•œ ê³ ê°ëª… ì‚¬ìš©, ì—†ìœ¼ë©´ í•´ë‹¹ ì‹œíŠ¸ì˜ ê³ ê°ëª… ì‚¬ìš©
          const sheetCustomerName = getRowValue(row, SH_R_headers, ['í•œê¸€ì´ë¦„', 'ê³ ê°ëª…', 'ì´ë¦„']);
          const customerName = getCustomerNameByOrderId(orderId) || sheetCustomerName;
          
          if (idx < 3) {
            console.log(`Cruise ${idx}:`, { orderId, customerName, sheetCustomerName, fromSHM: !!getCustomerNameByOrderId(orderId) });
          }
          
          results.push({
            type: 'cruise',
            orderId,
            customerName,
            customerEnglishName: getRowValue(row, SH_R_headers, ['ì˜ë¬¸ì´ë¦„', 'ê³ ê°ëª…(ì˜ë¬¸)']),
            date,
            cruise: getRowValue(row, SH_R_headers, ['í¬ë£¨ì¦ˆ', 'í¬ë£¨ì¦ˆëª…']),
            roomType: getRowValue(row, SH_R_headers, ['ê°ì‹¤ì¢…ë¥˜', 'ê°ì‹¤íƒ€ì…', 'ê°ì‹¤']),
            adult: getRowValue(row, SH_R_headers, ['ADULT', 'CHILD', 'ì„±ì¸'])
          });
        }
      });
    }

    // ìŠ¤í•˜ ì°¨ëŸ‰ (SH_C)
    if (Array.isArray(SH_C_data)) {
      SH_C_data.forEach((row, idx) => {
        const orderId = getRowValue(row, SH_C_headers, ['ì˜ˆì•½ë²ˆí˜¸', 'ì£¼ë¬¸ë²ˆí˜¸', 'ID']);
        if (orderId) {
          const date = getRowValue(row, SH_C_headers, ['íƒ‘ìŠ¹ì¼', 'ë‚ ì§œ', 'ì˜ˆì•½ì¼']);
          const sheetCustomerName = getRowValue(row, SH_C_headers, ['ê³ ê°ëª…', 'ì´ë¦„']);
          const customerName = getCustomerNameByOrderId(orderId) || sheetCustomerName;
          
          results.push({
            type: 'vehicle',
            orderId,
            customerName,
            date,
            vehicleNumber: getRowValue(row, SH_C_headers, ['ì°¨ëŸ‰ë²ˆí˜¸', 'ì°¨ëŸ‰']),
            seatNumber: getRowValue(row, SH_C_headers, ['ì¢Œì„', 'ì¢Œì„ë²ˆí˜¸']),
            category: getRowValue(row, SH_C_headers, ['ë¶„ë¥˜', 'ì¹´í…Œê³ ë¦¬'])
          });
        }
      });
    }

    // ì¼ë°˜ ì°¨ëŸ‰ (SH_CC)
    if (Array.isArray(SH_CC_data)) {
      SH_CC_data.forEach((row, idx) => {
        const orderId = getRowValue(row, SH_CC_headers, ['ì˜ˆì•½ë²ˆí˜¸', 'ì£¼ë¬¸ë²ˆí˜¸', 'ID']);
        if (orderId) {
          const date = getRowValue(row, SH_CC_headers, ['í”½ì—…ì¼ì‹œ', 'í”½ì—…ì¼', 'ë‚ ì§œ']);
          const sheetCustomerName = getRowValue(row, SH_CC_headers, ['ê³ ê°ëª…', 'ì´ë¦„']);
          const customerName = getCustomerNameByOrderId(orderId) || sheetCustomerName;
          
          results.push({
            type: 'car',
            orderId,
            customerName,
            date,
            carType: getRowValue(row, SH_CC_headers, ['ì°¨ëŸ‰íƒ€ì…', 'ì°¨ëŸ‰']),
            pickupLocation: getRowValue(row, SH_CC_headers, ['í”½ì—…ì¥ì†Œ', 'ìŠ¹ì°¨ì§€']),
            dropoffLocation: getRowValue(row, SH_CC_headers, ['í•˜ì°¨ì¥ì†Œ', 'í•˜ì°¨ì§€'])
          });
        }
      });
    }

    // ê³µí•­ (SH_P)
    if (Array.isArray(SH_P_data)) {
      SH_P_data.forEach((row, idx) => {
        const orderId = getRowValue(row, SH_P_headers, ['ì˜ˆì•½ë²ˆí˜¸', 'ì£¼ë¬¸ë²ˆí˜¸', 'ID']);
        if (orderId) {
          const date = getRowValue(row, SH_P_headers, ['ì˜ˆì•½ì¼', 'ë‚ ì§œ', 'í”½ì—…ì¼']);
          const sheetCustomerName = getRowValue(row, SH_P_headers, ['ê³ ê°ëª…', 'ì´ë¦„']);
          const customerName = getCustomerNameByOrderId(orderId) || sheetCustomerName;
          
          results.push({
            type: 'airport',
            orderId,
            customerName,
            date,
            airportName: getRowValue(row, SH_P_headers, ['ê³µí•­ëª…', 'ê³µí•­']),
            flightNumber: getRowValue(row, SH_P_headers, ['í•­ê³µí¸', 'í•­ê³µì‚¬']),
            time: getRowValue(row, SH_P_headers, ['ì‹œê°„', 'ì‹œê°'])
          });
        }
      });
    }

    // í˜¸í…” (SH_H)
    if (Array.isArray(SH_H_data)) {
      SH_H_data.forEach((row, idx) => {
        const orderId = getRowValue(row, SH_H_headers, ['ì˜ˆì•½ë²ˆí˜¸', 'ì£¼ë¬¸ë²ˆí˜¸', 'ID']);
        if (orderId) {
          const date = getRowValue(row, SH_H_headers, ['ì²´í¬ì¸ì¼', 'ë‚ ì§œ', 'ì˜ˆì•½ì¼']);
          const sheetCustomerName = getRowValue(row, SH_H_headers, ['ê³ ê°ëª…', 'ì´ë¦„']);
          const customerName = getCustomerNameByOrderId(orderId) || sheetCustomerName;
          
          results.push({
            type: 'hotel',
            orderId,
            customerName,
            date,
            hotelName: getRowValue(row, SH_H_headers, ['í˜¸í…”ëª…', 'í˜¸í…”']),
            roomName: getRowValue(row, SH_H_headers, ['ê°ì‹¤', 'ê°ì‹¤íƒ€ì…']),
            days: getRowValue(row, SH_H_headers, ['ë°•ìˆ˜', 'ìˆ™ë°•ì¼'])
          });
        }
      });
    }

    // íˆ¬ì–´ (SH_T)
    if (Array.isArray(SH_T_data)) {
      SH_T_data.forEach((row, idx) => {
        const orderId = getRowValue(row, SH_T_headers, ['ì˜ˆì•½ë²ˆí˜¸', 'ì£¼ë¬¸ë²ˆí˜¸', 'ID']);
        if (orderId) {
          const date = getRowValue(row, SH_T_headers, ['ì‹œì‘ì¼', 'ë‚ ì§œ', 'ì˜ˆì•½ì¼']);
          const sheetCustomerName = getRowValue(row, SH_T_headers, ['ê³ ê°ëª…', 'ì´ë¦„']);
          const customerName = getCustomerNameByOrderId(orderId) || sheetCustomerName;
          
          results.push({
            type: 'tour',
            orderId,
            customerName,
            date,
            tourName: getRowValue(row, SH_T_headers, ['íˆ¬ì–´ëª…', 'íˆ¬ì–´']),
            tourType: getRowValue(row, SH_T_headers, ['íˆ¬ì–´íƒ€ì…', 'ì¢…ë¥˜']),
            participants: getRowValue(row, SH_T_headers, ['ì¸ì›', 'ì°¸ê°€ì'])
          });
        }
      });
    }

    // ë ŒíŠ¸ì¹´ (SH_RC)
    if (Array.isArray(SH_RC_data)) {
      SH_RC_data.forEach((row, idx) => {
        const orderId = getRowValue(row, SH_RC_headers, ['ì˜ˆì•½ë²ˆí˜¸', 'ì£¼ë¬¸ë²ˆí˜¸', 'ID']);
        if (orderId) {
          const date = getRowValue(row, SH_RC_headers, ['í”½ì—…ì¼', 'ë‚ ì§œ', 'ì˜ˆì•½ì¼']);
          const sheetCustomerName = getRowValue(row, SH_RC_headers, ['ê³ ê°ëª…', 'ì´ë¦„']);
          const customerName = getCustomerNameByOrderId(orderId) || sheetCustomerName;
          
          results.push({
            type: 'rentcar',
            orderId,
            customerName,
            date,
            carType: getRowValue(row, SH_RC_headers, ['ì°¨ëŸ‰íƒ€ì…', 'ì°¨ëŸ‰']),
            pickupTime: getRowValue(row, SH_RC_headers, ['í”½ì—…ì‹œê°„', 'ì‹œê°„']),
            usagePeriod: getRowValue(row, SH_RC_headers, ['ì‚¬ìš©ê¸°ê°„', 'ê¸°ê°„'])
          });
        }
      });
    }

    return results;
  }, [SH_R_data, SH_R_headers, SH_C_data, SH_C_headers, SH_CC_data, SH_CC_headers, SH_P_data, SH_P_headers, SH_H_data, SH_H_headers, SH_T_data, SH_T_headers, SH_RC_data, SH_RC_headers, SH_M_data, SH_M_headers, getCustomerNameByOrderId]);

  // í•„í„°ë§ëœ ì˜ˆì•½
  const filteredReservations = useMemo(() => {
    const selectedDateObj = new Date(selectedDate);
    selectedDateObj.setHours(0, 0, 0, 0);

    return allReservations.filter(reservation => {
      // íƒ€ì… í•„í„°
      if (typeFilter !== 'all' && reservation.type !== typeFilter) {
        return false;
      }

      // ë‚ ì§œ í•„í„°
      const date = parseDate(reservation.date);
      if (!date) return false;
      date.setHours(0, 0, 0, 0);

      return isSameDate(date, selectedDateObj);
    });
  }, [allReservations, selectedDate, typeFilter]);

  // ì„œë¹„ìŠ¤ ì •ë³´
  const getServiceInfo = (type) => {
    const services = {
      cruise: { icon: 'ğŸš¢', name: 'í¬ë£¨ì¦ˆ', color: '#3B82F6' },
      car: { icon: 'ğŸš—', name: 'ì°¨ëŸ‰', color: '#3B82F6' },
      vehicle: { icon: 'ğŸš—', name: 'ìŠ¤í•˜ì°¨ëŸ‰', color: '#A855F7' },
      airport: { icon: 'âœˆï¸', name: 'ê³µí•­', color: '#10B981' },
      hotel: { icon: 'ğŸ¨', name: 'í˜¸í…”', color: '#F97316' },
      tour: { icon: 'ğŸ“', name: 'íˆ¬ì–´', color: '#EF4444' },
      rentcar: { icon: 'ğŸš™', name: 'ë ŒíŠ¸ì¹´', color: '#6366F1' }
    };
    return services[type] || { icon: 'ğŸ“…', name: 'ê¸°íƒ€', color: '#6B7280' };
  };

  // ë‚ ì§œ ë„¤ë¹„ê²Œì´ì…˜
  const navigateDate = (direction) => {
    const newDate = new Date(selectedDate);
    newDate.setDate(newDate.getDate() + (direction === 'next' ? 1 : -1));
    setSelectedDate(newDate);
  };

  // ì„œë¹„ìŠ¤ë³„ ê·¸ë£¹í™”
  const groupedByService = useMemo(() => {
    const grouped = {};
    filteredReservations.forEach(res => {
      if (!grouped[res.type]) {
        grouped[res.type] = [];
      }
      grouped[res.type].push(res);
    });
    return grouped;
  }, [filteredReservations]);

  // ì˜ˆì•½ ì¹´ë“œ ë Œë”ë§
  const renderCard = (reservation) => {
    const info = getServiceInfo(reservation.type);

    return (
      <div
        key={`${reservation.orderId}-${reservation.type}`}
        style={{
          backgroundColor: '#F9FAFB',
          border: '1px solid #E5E7EB',
          borderRadius: '8px',
          boxShadow: '0 1px 2px rgba(0,0,0,0.05)',
          padding: '12px',
          display: 'flex',
          flexDirection: 'column',
          height: '100%'
        }}
      >
        {/* í—¤ë” */}
        <div style={{
          display: 'flex',
          alignItems: 'center',
          gap: '8px',
          marginBottom: '8px',
          paddingBottom: '8px',
          borderBottom: '1px solid #F3F4F6'
        }}>
          <span style={{ fontSize: '1.5rem' }}>{info.icon}</span>
          <h5 style={{
            fontWeight: 'bold',
            fontSize: '0.875rem',
            flex: 1,
            color: '#1F2937',
            margin: 0,
            overflow: 'hidden',
            textOverflow: 'ellipsis',
            whiteSpace: 'nowrap'
          }}>
            {info.name}
          </h5>
          <span style={{
            padding: '4px 8px',
            borderRadius: '9999px',
            fontSize: '0.75rem',
            fontWeight: '500',
            backgroundColor: info.color + '20',
            color: info.color
          }}>
            ì˜ˆì •
          </span>
        </div>

        {/* ë‚´ìš© */}
        <div style={{ display: 'flex', flexDirection: 'column', gap: '4px', fontSize: '0.875rem', color: '#374151' }}>
          {reservation.customerName && (
            <div style={{
              fontWeight: 'bold',
              color: info.color,
              marginBottom: '4px',
              borderBottom: '1px solid #F3F4F6',
              paddingBottom: '4px'
            }}>
              {reservation.customerName}
            </div>
          )}

          {/* í¬ë£¨ì¦ˆ */}
          {reservation.type === 'cruise' && (
            <>
              <div><span style={{ fontWeight: '600', color: '#6B7280' }}>í¬ë£¨ì¦ˆ:</span> {reservation.cruise}</div>
              <div><span style={{ fontWeight: '600', color: '#6B7280' }}>ê°ì‹¤:</span> {reservation.roomType}</div>
              {reservation.adult && <div><span style={{ fontWeight: '600', color: '#6B7280' }}>ì¸ì›:</span> {reservation.adult}</div>}
            </>
          )}

          {/* ìŠ¤í•˜ì°¨ëŸ‰ */}
          {reservation.type === 'vehicle' && (
            <>
              <div><span style={{ fontWeight: '600', color: '#6B7280' }}>ì°¨ëŸ‰:</span> {reservation.vehicleNumber}</div>
              <div><span style={{ fontWeight: '600', color: '#6B7280' }}>ì¢Œì„:</span> {reservation.seatNumber}</div>
              {reservation.category && <div><span style={{ fontWeight: '600', color: '#6B7280' }}>ë¶„ë¥˜:</span> {reservation.category}</div>}
            </>
          )}

          {/* ì¼ë°˜ ì°¨ëŸ‰ */}
          {reservation.type === 'car' && (
            <>
              <div><span style={{ fontWeight: '600', color: '#6B7280' }}>ì°¨ëŸ‰:</span> {reservation.carType}</div>
              {reservation.pickupLocation && <div><span style={{ fontWeight: '600', color: '#6B7280' }}>ìŠ¹ì°¨:</span> {reservation.pickupLocation}</div>}
              {reservation.dropoffLocation && <div><span style={{ fontWeight: '600', color: '#6B7280' }}>í•˜ì°¨:</span> {reservation.dropoffLocation}</div>}
            </>
          )}

          {/* ê³µí•­ */}
          {reservation.type === 'airport' && (
            <>
              <div><span style={{ fontWeight: '600', color: '#6B7280' }}>ê³µí•­:</span> {reservation.airportName}</div>
              <div><span style={{ fontWeight: '600', color: '#6B7280' }}>í•­ê³µí¸:</span> {reservation.flightNumber}</div>
              {reservation.time && <div><span style={{ fontWeight: '600', color: '#6B7280' }}>ì‹œê°„:</span> {reservation.time}</div>}
            </>
          )}

          {/* í˜¸í…” */}
          {reservation.type === 'hotel' && (
            <>
              <div><span style={{ fontWeight: '600', color: '#6B7280' }}>í˜¸í…”:</span> {reservation.hotelName}</div>
              <div><span style={{ fontWeight: '600', color: '#6B7280' }}>ê°ì‹¤:</span> {reservation.roomName}</div>
              {reservation.days && <div><span style={{ fontWeight: '600', color: '#6B7280' }}>ê¸°ê°„:</span> {reservation.days}ë°•</div>}
            </>
          )}

          {/* íˆ¬ì–´ */}
          {reservation.type === 'tour' && (
            <>
              <div><span style={{ fontWeight: '600', color: '#6B7280' }}>íˆ¬ì–´:</span> {reservation.tourName}</div>
              <div><span style={{ fontWeight: '600', color: '#6B7280' }}>ì¢…ë¥˜:</span> {reservation.tourType}</div>
              {reservation.participants && <div><span style={{ fontWeight: '600', color: '#6B7280' }}>ì¸ì›:</span> {reservation.participants}</div>}
            </>
          )}

          {/* ë ŒíŠ¸ì¹´ */}
          {reservation.type === 'rentcar' && (
            <>
              <div><span style={{ fontWeight: '600', color: '#6B7280' }}>ì°¨ëŸ‰:</span> {reservation.carType}</div>
              {reservation.pickupTime && <div><span style={{ fontWeight: '600', color: '#6B7280' }}>ì‹œê°„:</span> {reservation.pickupTime}</div>}
              {reservation.usagePeriod && <div><span style={{ fontWeight: '600', color: '#6B7280' }}>ê¸°ê°„:</span> {reservation.usagePeriod}</div>}
            </>
          )}

          {/* ë‚ ì§œ */}
          <div style={{ marginTop: '8px', paddingTop: '8px', borderTop: '1px solid #F3F4F6', fontWeight: '500' }}>
            ğŸ“… {reservation.date}
          </div>
        </div>
      </div>
    );
  };

  // ë Œë”ë§
  return (
    <div style={{ padding: '24px', backgroundColor: '#F3F4F6', minHeight: '100vh' }}>
      <div style={{ maxWidth: '1280px', margin: '0 auto' }}>
        {/* í—¤ë” */}
        <div style={{
          backgroundColor: '#FFF',
          borderRadius: '8px',
          boxShadow: '0 1px 3px rgba(0,0,0,0.1)',
          padding: '24px',
          marginBottom: '24px'
        }}>
          <h1 style={{ fontSize: '1.875rem', fontWeight: 'bold', color: '#1F2937', marginBottom: '24px' }}>
            ì‚¬ìš©ì¼ë³„ ì˜ˆì•½ ì¡°íšŒ
          </h1>

          {/* ë‚ ì§œ ë„¤ë¹„ê²Œì´ì…˜ */}
          <div style={{
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'space-between',
            marginBottom: '16px',
            flexWrap: 'wrap',
            gap: '16px'
          }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
              <button
                onClick={() => navigateDate('prev')}
                style={{
                  padding: '8px 12px',
                  backgroundColor: '#F3F4F6',
                  border: 'none',
                  borderRadius: '8px',
                  cursor: 'pointer',
                  fontSize: '16px'
                }}
              >
                â—€
              </button>

              <h2 style={{ fontSize: '1.5rem', fontWeight: '600', margin: 0, minWidth: '200px' }}>
                {selectedDate.toLocaleDateString('ko-KR', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric'
                })}
              </h2>

              <button
                onClick={() => setSelectedDate(new Date())}
                style={{
                  padding: '6px 12px',
                  backgroundColor: '#EFF6FF',
                  color: '#0284C7',
                  border: '1px solid #BAE6FD',
                  borderRadius: '8px',
                  fontSize: '0.875rem',
                  fontWeight: '500',
                  cursor: 'pointer'
                }}
              >
                ì˜¤ëŠ˜
              </button>

              <button
                onClick={() => navigateDate('next')}
                style={{
                  padding: '8px 12px',
                  backgroundColor: '#F3F4F6',
                  border: 'none',
                  borderRadius: '8px',
                  cursor: 'pointer',
                  fontSize: '16px'
                }}
              >
                â–¶
              </button>
            </div>
          </div>

          {/* íƒ€ì… í•„í„° */}
          <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap', alignItems: 'center' }}>
            <span style={{ fontSize: '1.25rem' }}>ğŸ”</span>
            <button
              onClick={() => setTypeFilter('all')}
              style={{
                padding: '6px 12px',
                borderRadius: '9999px',
                fontSize: '0.875rem',
                border: 'none',
                cursor: 'pointer',
                backgroundColor: typeFilter === 'all' ? '#3B82F6' : '#E5E7EB',
                color: typeFilter === 'all' ? '#FFF' : '#4B5563'
              }}
            >
              ì „ì²´
            </button>
            {['cruise', 'car', 'vehicle', 'airport', 'hotel', 'tour', 'rentcar'].map(type => (
              <button
                key={type}
                onClick={() => setTypeFilter(type)}
                style={{
                  padding: '6px 12px',
                  borderRadius: '9999px',
                  fontSize: '0.875rem',
                  border: 'none',
                  cursor: 'pointer',
                  backgroundColor: typeFilter === type ? '#3B82F6' : '#E5E7EB',
                  color: typeFilter === type ? '#FFF' : '#4B5563'
                }}
              >
                {getServiceInfo(type).name}
              </button>
            ))}
          </div>
        </div>

        {/* ì˜ˆì•½ ëª©ë¡ */}
        <div style={{
          backgroundColor: '#FFF',
          borderRadius: '8px',
          boxShadow: '0 1px 3px rgba(0,0,0,0.1)',
          padding: '24px'
        }}>
          {loading ? (
            <div style={{ textAlign: 'center', padding: '48px' }}>
              <div style={{
                display: 'inline-block',
                width: '40px',
                height: '40px',
                border: '4px solid #3B82F6',
                borderTop: 'transparent',
                borderRadius: '50%',
                animation: 'spin 1s linear infinite'
              }} />
              <style>{`@keyframes spin { to { transform: rotate(360deg); } }`}</style>
              <p style={{ marginTop: '16px', color: '#6B7280' }}>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
          ) : filteredReservations.length === 0 ? (
            <div style={{ textAlign: 'center', padding: '48px' }}>
              <div style={{ fontSize: '2rem', marginBottom: '16px' }}>ğŸ“…</div>
              <h3 style={{ color: '#4B5563', marginBottom: '8px' }}>
                {typeFilter === 'all' ? 'ì˜ˆì•½ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤' : `${getServiceInfo(typeFilter).name} ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤`}
              </h3>
            </div>
          ) : (
            <div>
              {Object.entries(groupedByService).map(([serviceType, reservationList]) => {
                if (reservationList.length === 0) return null;
                const info = getServiceInfo(serviceType);
                return (
                  <div key={serviceType} style={{ marginBottom: '32px' }}>
                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '12px',
                      marginBottom: '16px',
                      paddingBottom: '12px',
                      borderBottom: '2px solid #E5E7EB'
                    }}>
                      <span style={{ fontSize: '1.5rem' }}>{info.icon}</span>
                      <h3 style={{ fontSize: '1.125rem', fontWeight: '600', color: '#1F2937', margin: 0 }}>
                        {info.name}
                        <span style={{ marginLeft: '8px', fontSize: '0.875rem', color: '#6B7280' }}>
                          ({reservationList.length}ê±´)
                        </span>
                      </h3>
                    </div>

                    <div style={{
                      display: 'grid',
                      gridTemplateColumns: 'repeat(auto-fill, minmax(250px, 1fr))',
                      gap: '16px'
                    }}>
                      {reservationList.map((res) => renderCard(res))}
                    </div>
                  </div>
                );
              })}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

export default UsageDateDashboard;
